---
phase: 03-dashboard-trip-explorer
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/pages/DashboardPage.tsx
  - frontend/src/components/DashboardSummaryCards.tsx
  - frontend/src/components/UrgentAlerts.tsx
  - frontend/src/components/UpcomingReservations.tsx
autonomous: true
user_setup: []

must_haves:
  truths:
    - "User sees a dashboard page with summary cards showing contract count, total points, available points, and committed points"
    - "Dashboard highlights contracts with banking deadlines within 60 days"
    - "Dashboard highlights contracts with points expiring within 90 days"
    - "Dashboard shows upcoming reservations in a compact list"
    - "Dashboard handles loading, error, and empty states gracefully"
  artifacts:
    - path: "frontend/src/pages/DashboardPage.tsx"
      provides: "Dashboard page composing existing hooks for contracts, availability, and reservations"
      min_lines: 40
    - path: "frontend/src/components/DashboardSummaryCards.tsx"
      provides: "Grid of summary stat cards (contracts, total, available, committed)"
      min_lines: 25
    - path: "frontend/src/components/UrgentAlerts.tsx"
      provides: "Warning card for banking deadlines and expiring points"
      min_lines: 20
    - path: "frontend/src/components/UpcomingReservations.tsx"
      provides: "Compact list of upcoming reservations with resort, dates, and point cost"
      min_lines: 20
  key_links:
    - from: "frontend/src/pages/DashboardPage.tsx"
      to: "frontend/src/hooks/useAvailability.ts"
      via: "useAvailability(todayISO) call for point data and urgency info"
      pattern: "useAvailability"
    - from: "frontend/src/pages/DashboardPage.tsx"
      to: "frontend/src/hooks/useContracts.ts"
      via: "useContracts() call for contract count"
      pattern: "useContracts"
    - from: "frontend/src/pages/DashboardPage.tsx"
      to: "frontend/src/hooks/useReservations.ts"
      via: "useReservations({ upcoming: true }) call for upcoming reservations"
      pattern: "useReservations.*upcoming"
    - from: "frontend/src/components/UrgentAlerts.tsx"
      to: "frontend/src/types/index.ts"
      via: "Uses AvailabilityContractResult type for banking/expiration data"
      pattern: "AvailabilityContractResult"
---

<objective>
Build the Dashboard home page as a frontend composition of existing API endpoints. No new backend work required.

Purpose: The dashboard gives the user a unified at-a-glance view of their complete DVC picture -- contracts, point balances, urgency alerts, and upcoming reservations -- all on a single page. This is the DASH-01 and DASH-02 requirements.

Output: DashboardPage with three sections: summary cards, urgent alerts, and upcoming reservations. All data fetched via existing hooks (useContracts, useAvailability, useReservations).
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03/03-RESEARCH.md

@frontend/src/pages/AvailabilityPage.tsx
@frontend/src/hooks/useAvailability.ts
@frontend/src/hooks/useContracts.ts
@frontend/src/hooks/useReservations.ts
@frontend/src/types/index.ts
@frontend/src/components/AvailabilityCard.tsx
@frontend/src/lib/utils.ts
@frontend/src/lib/api.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Dashboard summary cards and urgent alerts components</name>
  <files>frontend/src/components/DashboardSummaryCards.tsx, frontend/src/components/UrgentAlerts.tsx, frontend/src/components/UpcomingReservations.tsx</files>
  <action>
**Create `frontend/src/components/DashboardSummaryCards.tsx`:**

Props: `{ availability: AvailabilityResponse | undefined; contracts: ContractWithDetails[] | undefined }`

Renders a 4-column responsive grid (`grid gap-4 sm:grid-cols-2 lg:grid-cols-4`) with Card components (from `@/components/ui/card`):
1. **Contracts** -- `contracts?.length ?? "--"` with text-3xl font-bold
2. **Total Points** -- `availability?.summary.total_points ?? "--"`
3. **Available Points** -- `availability?.summary.total_available ?? "--"` in text-green-600
4. **Committed** -- `availability?.summary.total_committed ?? "--"` in text-amber-600

Each card: CardHeader with CardTitle (text-sm text-muted-foreground label), CardContent with text-3xl font-bold value. Follow the exact Card/CardHeader/CardContent pattern from existing components (see AvailabilityCard.tsx).

**Create `frontend/src/components/UrgentAlerts.tsx`:**

Props: `{ items: AvailabilityContractResult[] }`

Only rendered when items.length > 0 (the parent page handles this check).

Renders a Card with `border-amber-200 bg-amber-50` styling:
- Header with AlertTriangleIcon (from lucide-react, size-4) + "Action Needed" text in font-semibold text-amber-800
- List (`<ul className="space-y-2">`) of alert items:
  - For items where `!banking_deadline_passed && days_until_banking_deadline <= 60`: Show ClockIcon (from lucide-react) + "{contract_name}: Banking deadline in {days_until_banking_deadline} days ({available_points} pts available)" in text-amber-700
  - For items where `days_until_expiration <= 90`: Show AlertTriangleIcon + "{contract_name}: Points expire in {days_until_expiration} days" in text-red-700
  - A single contract can show both alerts (banking AND expiration) -- render both if applicable

Use icons: `import { AlertTriangleIcon, ClockIcon } from "lucide-react"`

**Create `frontend/src/components/UpcomingReservations.tsx`:**

Props: `{ reservations: Reservation[] | undefined }`

Import: `type { Reservation } from "../types"`, `parseRoomKey` and `formatDateRange` from `../lib/utils`, Card/CardContent/CardHeader/CardTitle from `@/components/ui/card`.

Renders a Card with:
- CardHeader: CardTitle "Upcoming Reservations"
- CardContent: If no reservations or empty, show "No upcoming reservations" in text-muted-foreground.
- Otherwise, render a compact list (`<ul className="space-y-3">`) with each reservation showing:
  - Resort slug formatted (replace underscores with spaces, title case -- OR use the resort field directly since it's a slug. Keep it simple: just display the slug with underscores replaced by spaces and title-cased.)
  - Room info via `parseRoomKey(reservation.room_key)` -- show room type and view
  - Date range via `formatDateRange(reservation.check_in, reservation.check_out)`
  - Points cost: `{reservation.points_cost} pts` in text-sm font-medium
- Show at most 5 reservations. If more exist, show a "View all reservations" link (`<a href="/reservations">`) at the bottom.
  </action>
  <verify>
```bash
cd /Users/julianamacbook/dvc && npx tsc --noEmit
```
TypeScript compiles without errors. All three component files exist and import from existing types/components correctly.
  </verify>
  <done>
Three new components created: DashboardSummaryCards (4-stat grid), UrgentAlerts (banking deadline + expiration warnings), UpcomingReservations (compact reservation list). All use existing shadcn/ui Card components and TypeScript types.
  </done>
</task>

<task type="auto">
  <name>Task 2: Dashboard page composing existing hooks</name>
  <files>frontend/src/pages/DashboardPage.tsx</files>
  <action>
**Create `frontend/src/pages/DashboardPage.tsx`:**

Import and use existing hooks -- NO new hooks needed. The dashboard composes three parallel TanStack Query calls:
1. `useContracts()` from `../hooks/useContracts` -- for contract count
2. `useAvailability(todayISO())` from `../hooks/useAvailability` -- for point totals and urgency data
3. `useReservations({ upcoming: true })` from `../hooks/useReservations` -- for upcoming reservations

Define `todayISO()` locally (same pattern as AvailabilityPage.tsx):
```typescript
function todayISO(): string {
  return new Date().toISOString().split("T")[0];
}
```

**Page structure:**

Header section:
- `<h2 className="text-2xl font-bold tracking-tight">Dashboard</h2>` (same pattern as other pages)
- `<p className="text-sm text-muted-foreground">Your DVC points at a glance</p>`

Loading state: If any of the three queries are loading, show "Loading dashboard..." in text-muted-foreground.

Error state: If any query has an error, show error message in text-destructive.

Content (wrapped in `<div className="space-y-6">`):
1. `<DashboardSummaryCards availability={availability} contracts={contracts} />`
2. Urgent alerts section: Derive `urgentItems` using `useMemo` from `availability?.contracts`:
   - Filter contracts where `(!c.banking_deadline_passed && c.days_until_banking_deadline <= 60) || c.days_until_expiration <= 90`
   - Only render `<UrgentAlerts items={urgentItems} />` if `urgentItems.length > 0`
3. `<UpcomingReservations reservations={reservations} />`

**Important:** The `useMemo` dependency is `[availability]` (the full availability data object). The `useContracts` hook returns `ContractWithDetails[]` per the existing hook.

**Do NOT:**
- Create a useDashboard.ts hook. The composition is simple enough to live in the page component directly. Three hook calls + one useMemo is fine.
- Add date picker to the dashboard. The dashboard always shows today's data. The user can go to the Availability page for custom dates.
  </action>
  <verify>
```bash
cd /Users/julianamacbook/dvc && npx tsc --noEmit
```
TypeScript compiles without errors. DashboardPage.tsx exists and imports the three new components plus existing hooks.
  </verify>
  <done>
DashboardPage renders summary cards, urgent alerts (when applicable), and upcoming reservations using data from three existing API endpoints via parallel TanStack Query calls. No new backend endpoints or hooks needed.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no type errors
2. DashboardPage imports useContracts, useAvailability, useReservations
3. DashboardSummaryCards shows 4 stat cards using availability and contracts data
4. UrgentAlerts filters on banking_deadline <= 60 days AND expiration <= 90 days
5. UpcomingReservations shows compact reservation list with resort, room, dates, points
6. All components use existing shadcn/ui Card primitives and TypeScript types
</verification>

<success_criteria>
- Dashboard page composes existing hooks with no new backend endpoints
- Summary cards show contract count, total points, available points, committed points
- Urgent alerts highlight banking deadlines within 60 days and expirations within 90 days
- Upcoming reservations shown in compact format
- Loading and empty states handled gracefully
- TypeScript compiles cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/03/03-02-SUMMARY.md`
</output>
