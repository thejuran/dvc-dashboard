---
phase: 06-what-if-scenarios
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/types/index.ts
  - frontend/src/store/useScenarioStore.ts
  - frontend/src/hooks/useScenarioEvaluation.ts
  - frontend/src/components/Layout.tsx
  - frontend/src/App.tsx
autonomous: true

must_haves:
  truths:
    - "Zustand store holds hypothetical bookings with add/remove/clear actions"
    - "Evaluation hook calls POST /api/scenarios/evaluate when bookings exist"
    - "Scenarios nav item appears in sidebar and /scenarios route is registered"
  artifacts:
    - path: "frontend/src/store/useScenarioStore.ts"
      provides: "Zustand store for ephemeral scenario bookings"
      exports: ["useScenarioStore"]
    - path: "frontend/src/hooks/useScenarioEvaluation.ts"
      provides: "React Query hook for scenario evaluation"
      exports: ["useScenarioEvaluation"]
    - path: "frontend/src/types/index.ts"
      provides: "Scenario TypeScript interfaces"
      contains: "ScenarioEvaluateResponse"
  key_links:
    - from: "frontend/src/hooks/useScenarioEvaluation.ts"
      to: "/api/scenarios/evaluate"
      via: "api.post call"
      pattern: "api\\.post.*scenarios/evaluate"
    - from: "frontend/src/store/useScenarioStore.ts"
      to: "frontend/src/types/index.ts"
      via: "HypotheticalBooking type import"
      pattern: "HypotheticalBooking"
    - from: "frontend/src/App.tsx"
      to: "frontend/src/pages/ScenarioPage.tsx"
      via: "Route element"
      pattern: 'path="/scenarios"'
---

<objective>
Set up the frontend infrastructure for scenarios: TypeScript types, Zustand store (first activation in project), evaluation hook, route, and nav item. This plan creates the plumbing that Plan 03 consumes to build the full UI.

Purpose: Establishes the client-side data layer for SCEN-01 (add bookings to scenario), SCEN-02 (evaluation hook), and SCEN-04 (clear via store.clearAll). Also provides navigation to the scenario workspace.

Output: Scenario types in index.ts, useScenarioStore.ts (Zustand), useScenarioEvaluation.ts (React Query), updated Layout.tsx and App.tsx with route/nav, and a placeholder ScenarioPage.
</objective>

<execution_context>
@.planning/phases/06-what-if-scenarios/06-RESEARCH.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@frontend/src/types/index.ts
@frontend/src/hooks/useBookingPreview.ts
@frontend/src/lib/api.ts
@frontend/src/components/Layout.tsx
@frontend/src/App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scenario types + Zustand store + evaluation hook</name>
  <files>
    frontend/src/types/index.ts
    frontend/src/store/useScenarioStore.ts
    frontend/src/hooks/useScenarioEvaluation.ts
  </files>
  <action>
    Add TypeScript interfaces to the END of `frontend/src/types/index.ts`:

    ```typescript
    // Scenario types

    export interface HypotheticalBooking {
      id: string;
      contract_id: number;
      contract_name: string;
      resort: string;
      resort_name: string;
      room_key: string;
      check_in: string;
      check_out: string;
    }

    export interface ContractScenarioResult {
      contract_id: number;
      contract_name: string;
      home_resort: string;
      baseline_available: number;
      baseline_total: number;
      baseline_committed: number;
      scenario_available: number;
      scenario_total: number;
      scenario_committed: number;
      impact: number;
    }

    export interface ResolvedBooking {
      contract_id: number;
      resort: string;
      room_key: string;
      check_in: string;
      check_out: string;
      points_cost: number;
      num_nights: number;
    }

    export interface ScenarioEvaluateResponse {
      contracts: ContractScenarioResult[];
      summary: {
        baseline_available: number;
        scenario_available: number;
        total_impact: number;
        num_hypothetical_bookings: number;
      };
      resolved_bookings: ResolvedBooking[];
      errors: { resort: string; room_key: string; error: string }[];
    }
    ```

    Create `frontend/src/store/` directory and `frontend/src/store/useScenarioStore.ts`:
    - This is the FIRST Zustand activation in the project (zustand@^5.0.11 already installed)
    - Use the curried `create<T>()(...)` TypeScript pattern per Zustand v5 docs
    - Store state: `bookings: HypotheticalBooking[]`
    - Store actions: `addBooking(booking: Omit<HypotheticalBooking, "id">)` -- generates id with `crypto.randomUUID()`, `removeBooking(id: string)`, `clearAll()` -- resets bookings to empty array
    - Import HypotheticalBooking from "../types"
    - Export named `useScenarioStore`

    Create `frontend/src/hooks/useScenarioEvaluation.ts`:
    - Follow the `useBookingPreview.ts` pattern (React Query with enabled flag)
    - Accept `bookings: HypotheticalBooking[]` parameter
    - `enabled: bookings.length > 0` -- do NOT call API with empty list
    - queryKey: `["scenario-evaluate", ...bookings.map(b => b.id)]` -- re-evaluate when bookings change
    - queryFn: POST to `/scenarios/evaluate` with body `{ hypothetical_bookings: bookings.map(b => ({ contract_id, resort, room_key, check_in, check_out })) }` -- strip client-only fields (id, contract_name, resort_name)
    - Return type: `ScenarioEvaluateResponse`
    - staleTime: 30_000 (same as booking preview)
    - Import api from "../lib/api" and types from "../types"
  </action>
  <verify>
    Run `cd /Users/julianamacbook/DVC/frontend && npx tsc --noEmit` -- zero TypeScript errors.
    Verify Zustand import works: `grep -r "from \"zustand\"" frontend/src/store/` shows the import.
  </verify>
  <done>
    Scenario types added to index.ts. Zustand store exports useScenarioStore with add/remove/clear. Evaluation hook calls POST /api/scenarios/evaluate when bookings exist. All TypeScript compiles.
  </done>
</task>

<task type="auto">
  <name>Task 2: Scenario route + nav item + placeholder page</name>
  <files>
    frontend/src/components/Layout.tsx
    frontend/src/App.tsx
    frontend/src/pages/ScenarioPage.tsx
  </files>
  <action>
    Update `frontend/src/components/Layout.tsx`:
    - Add `{ to: "/scenarios", label: "Scenarios" }` to the `navItems` array, placed AFTER "Trip Explorer" and BEFORE "Contracts" (logical grouping: planning tools together).

    Update `frontend/src/App.tsx`:
    - Add import: `import ScenarioPage from "./pages/ScenarioPage";`
    - Add route: `<Route path="/scenarios" element={<ScenarioPage />} />` after the trip-explorer route.

    Create `frontend/src/pages/ScenarioPage.tsx` as a minimal placeholder:
    - Import useScenarioStore and useScenarioEvaluation
    - Render a page header: "What-If Scenarios" with subtext "Model hypothetical bookings and compare point impact"
    - Show the current booking count from the store: `{bookings.length} hypothetical booking(s)`
    - Render a "Clear All" button (disabled when bookings.length === 0) that calls `clearAll()`
    - Show a placeholder message: "Full scenario workspace coming in next plan."
    - This proves the store, hook, and route wiring all work end-to-end.
    - Use shadcn Card and Button components consistent with other pages.
  </action>
  <verify>
    Run `cd /Users/julianamacbook/DVC/frontend && npx tsc --noEmit` -- zero TypeScript errors.
    Run `cd /Users/julianamacbook/DVC/frontend && npx vite build` -- production build succeeds.
    Verify route exists: `grep -n "scenarios" frontend/src/App.tsx` shows the route.
    Verify nav item: `grep -n "Scenarios" frontend/src/components/Layout.tsx` shows the nav entry.
  </verify>
  <done>
    /scenarios route registered in App.tsx. "Scenarios" appears in sidebar navigation. Placeholder page renders with store wiring (booking count, clear button). TypeScript compiles. Vite builds.
  </done>
</task>

</tasks>

<verification>
- `cd /Users/julianamacbook/DVC/frontend && npx tsc --noEmit` -- zero errors
- `cd /Users/julianamacbook/DVC/frontend && npx vite build` -- production build succeeds
- Zustand store is importable and typed correctly
- /scenarios route exists in App.tsx
- "Scenarios" nav item is in Layout.tsx sidebar
</verification>

<success_criteria>
- Zustand store manages hypothetical bookings array with add/remove/clear actions
- Evaluation hook POSTs to /api/scenarios/evaluate only when bookings exist
- /scenarios route renders placeholder page with store connectivity
- "Scenarios" appears in sidebar navigation between Trip Explorer and Contracts
- All TypeScript compiles, Vite production build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/06-what-if-scenarios/06-02-SUMMARY.md`
</output>
