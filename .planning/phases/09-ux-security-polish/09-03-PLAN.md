---
phase: 09-ux-security-polish
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - .gitignore
  - .env.example
  - backend/requirements.txt
  - frontend/package.json
  - frontend/package-lock.json
autonomous: true

must_haves:
  truths:
    - "No credentials, secrets, API keys, or tokens exist anywhere in committed code"
    - "All backend Python dependencies are pinned to exact major.minor.patch ranges with upper bounds"
    - "All frontend npm dependencies use exact versions (no ^ or ~ prefixes) in package.json"
    - ".env.example documents all configurable environment variables with descriptions"
    - "No known high/critical vulnerabilities exist in pinned dependencies"
  artifacts:
    - path: ".gitignore"
      provides: "Comprehensive gitignore covering secrets, build artifacts, OS files"
    - path: ".env.example"
      provides: "Template with all env vars documented"
    - path: "backend/requirements.txt"
      provides: "Pinned Python dependencies with exact version ranges"
    - path: "frontend/package.json"
      provides: "Pinned npm dependencies with exact versions"
  key_links:
    - from: ".gitignore"
      to: ".env"
      via: "Gitignore excludes .env files from commits"
      pattern: "\\.env"
---

<objective>
Audit the codebase for secrets/credentials, pin all dependencies to exact versions, and run vulnerability scans on both Python and npm dependency trees.

Purpose: SEC-01 (no secrets in committed code), SEC-03 (dependencies audited and pinned) -- the codebase must be safe for open-source release with no credential leaks and no known vulnerable dependencies.

Output: Clean secrets audit, pinned dependency files, vulnerability scan results.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@.gitignore
@.env.example
@backend/config.py
@backend/requirements.txt
@frontend/package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Secrets audit and .gitignore/.env.example hardening</name>
  <files>
    .gitignore
    .env.example
  </files>
  <action>
    **Secrets scan:**
    - Search the entire repo for patterns that could be secrets:
      - `grep -rn "password\|secret\|api_key\|token\|credential\|private_key" --include="*.py" --include="*.ts" --include="*.tsx" --include="*.js" --include="*.yml" --include="*.yaml" --include="*.json" --include="*.toml" --include="*.cfg" --include="*.ini"` (excluding node_modules, .git, package-lock.json)
      - `grep -rn "sk-\|pk_\|Bearer \|Basic [A-Z]" --include="*.py" --include="*.ts" --include="*.tsx"` for common API key patterns
      - Check for any hardcoded URLs with credentials: `grep -rn "://.*:.*@" --include="*.py" --include="*.ts" --include="*.tsx"`
    - Verify no .env file is committed: `git ls-files | grep -i '\.env$'` should return nothing.
    - Verify no database files are committed: `git ls-files | grep '\.db$'` should return nothing.

    **Harden .gitignore:**
    - Review current .gitignore and add any missing patterns:
      - Ensure `*.db-journal` is covered (SQLite journal files)
      - Ensure `.env.*` pattern covers `.env.production`, `.env.staging` etc. (add `.env*` with exception for `.env.example` using `!.env.example`)
      - Ensure `*.pem`, `*.key`, `*.p12` certificate/key files are excluded
      - Ensure `*.log` log files are excluded
      - Ensure `.planning/` directory is excluded (private project management, not for open source)
      - Ensure `coverage/`, `.coverage`, `htmlcov/` test coverage artifacts are excluded
      - Ensure `.pytest_cache/` is excluded
    - Do NOT break existing .gitignore entries. Add new patterns in logical groups with comments.

    **Update .env.example:**
    - Review backend/config.py to ensure all Settings fields are documented in .env.example.
    - Current Settings fields: `database_url`, `cors_origins`, `port`, `host`.
    - Ensure .env.example has a commented entry for each with description and default value.
    - Add a `HOST` entry if missing (default: 0.0.0.0).
    - Format: Each variable gets a comment line explaining it, then a commented-out assignment showing the default.
  </action>
  <verify>
    Run `git ls-files | grep -i '\.env$'` -- returns empty (no .env committed).
    Run `git ls-files | grep '\.db$'` -- returns empty (no .db committed).
    Review .gitignore has entries for .env*, *.pem, *.key, *.log, .planning/.
    Verify .env.example documents DATABASE_URL, CORS_ORIGINS, PORT, HOST.
  </verify>
  <done>
    No secrets, credentials, or API keys exist in committed code. .gitignore covers all sensitive file patterns. .env.example documents all configurable environment variables.
  </done>
</task>

<task type="auto">
  <name>Task 2: Pin dependencies and run vulnerability audit</name>
  <files>
    backend/requirements.txt
    frontend/package.json
    frontend/package-lock.json
  </files>
  <action>
    **Backend Python dependencies (requirements.txt):**
    - Current format uses ranges like `>=X.Y.Z,<X.(Y+1).0`. This is already well-pinned with upper bounds.
    - Run `pip install -r backend/requirements.txt` (if not already installed in venv) then `pip freeze` to get exact resolved versions.
    - Update requirements.txt to use tighter compatible-release format: `~=X.Y.Z` (allows patch bumps only) or keep the existing range format which is already good.
    - Actually, the current format `>=2.0.46,<2.1.0` is already pinned to minor version ranges. This is acceptable for open-source. Leave as-is unless a version has known vulnerabilities.
    - Run `pip audit` (install `pip-audit` if needed: `pip install pip-audit`) to check for known vulnerabilities in the resolved dependency tree.
    - If pip-audit finds vulnerabilities, update the affected package version in requirements.txt to the fixed version.
    - Document the audit results in the SUMMARY.

    **Frontend npm dependencies (package.json):**
    - Current format uses `^X.Y.Z` (caret ranges allowing minor bumps). For pinning:
    - Run `cd frontend && npm ls --depth=0 --json` to see currently resolved versions.
    - Update package.json to pin all `dependencies` and `devDependencies` to exact versions by removing `^` and `~` prefixes. For example: `"react": "19.2.4"` instead of `"react": "^19.2.4"`.
    - The package-lock.json already locks exact versions for installs, but pinning in package.json ensures explicit version control for the open-source repo.
    - Run `cd frontend && npm audit` to check for known vulnerabilities.
    - If npm audit finds vulnerabilities, run `npm audit fix` or manually update affected packages.
    - Run `cd frontend && npm install` to regenerate package-lock.json with the pinned versions.
    - Verify the frontend still builds: `cd frontend && npm run build`.

    **Verification:**
    - Ensure backend tests still pass after any dependency changes: `cd backend && python -m pytest`.
    - Ensure frontend builds cleanly: `cd frontend && npm run build`.
  </action>
  <verify>
    Run `cd frontend && npm run build` -- build succeeds.
    Run `grep '"\^' frontend/package.json | grep -v '//'` -- returns NO results (no caret ranges in dependencies).
    Run `cd frontend && npm audit --audit-level=high` -- no high/critical vulnerabilities (or document known exceptions).
    Run `cd backend && python -m pytest` -- all tests pass.
    Run `pip-audit -r backend/requirements.txt` -- no known vulnerabilities (or document known exceptions).
  </verify>
  <done>
    All frontend dependencies pinned to exact versions in package.json. All backend dependencies have upper-bounded version ranges. No known high/critical vulnerabilities in either dependency tree (or exceptions documented).
  </done>
</task>

</tasks>

<verification>
1. `git ls-files | grep -iE '\.env$|\.db$|\.pem$|\.key$'` returns empty
2. .gitignore covers .env*, *.pem, *.key, *.log, .planning/
3. .env.example documents all Settings fields from config.py
4. No `^` or `~` version prefixes in frontend/package.json dependencies
5. Backend requirements.txt has upper-bounded version ranges
6. `cd frontend && npm audit --audit-level=high` passes or exceptions documented
7. `pip-audit -r backend/requirements.txt` passes or exceptions documented
8. `cd frontend && npm run build` succeeds
9. `cd backend && python -m pytest` passes
</verification>

<success_criteria>
- Zero secrets, credentials, or API keys in committed code
- .gitignore is comprehensive for an open-source Python+Node project
- .env.example is complete with all configurable variables documented
- All dependencies pinned with no ^ or ~ prefixes (frontend) or with upper bounds (backend)
- No known high/critical vulnerabilities in dependency trees
- All existing tests and builds still pass
</success_criteria>

<output>
After completion, create `.planning/phases/09-ux-security-polish/09-03-SUMMARY.md`
</output>
